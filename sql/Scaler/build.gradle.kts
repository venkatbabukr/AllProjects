/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * To learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.7/samples
 */
plugins {
    java
}

repositories {
    mavenCentral()
}

subprojects {
    apply(plugin = "java")

    repositories {
        mavenCentral()
    }

    dependencies {
        implementation("com.h2database:h2:2.1.210")
    }

    // Define the path to the H2 database file in the build folder
    val dbFile = file("${buildDir}/h2db/testdb").absolutePath

    // Update the database URL to use a file-based H2 database
    val dbUrl = "jdbc:h2:file:$dbFile;"

    // Task to create tables
    tasks.register<Exec>("createTables") {
        commandLine("java", "-cp", configurations["runtimeClasspath"].asPath, "org.h2.tools.RunScript",
            "-url", dbUrl, 
            "-user", "sa", 
            "-password", "", 
            "-script", file("src/main/resources/create_tables.sql"))
    }

    // Task to load data
    tasks.register<Exec>("loadData") {
        commandLine("java", "-cp", configurations["runtimeClasspath"].asPath, "org.h2.tools.RunScript",
            "-url", dbUrl, 
            "-user", "sa", 
            "-password", "", 
            "-script", file("src/main/resources/load_data.sql"))
        dependsOn("createTables")
    }

    // Task to execute queries
    tasks.register<Exec>("executeQueries") {
        commandLine("java", "-cp", configurations["runtimeClasspath"].asPath, "org.h2.tools.RunScript",
            "-url", dbUrl, 
            "-user", "sa", 
            "-password", "", 
            "-script", file("src/main/resources/queries.sql"))
        dependsOn("loadData")
    }
}
